智能客服
项目简介：智能客服一个对企业用户、运营商用户提供自动问答的平台。在这个平台上，用户提问想要了解的产品信息，
智能机器人根据用户提问进行语义分析，并且给出相应的回答，回答内容不限于文字，图片，视频等，让用户对相关产品有全面的了解。
项目是采用的Linux+Tomcat+Mysql+javaScript架构，用户可以通过华为support网站的智能客服入口访问iknow，用户发送问题之后，AI Engine
处理问题返回答案（从redis , elastic数据库拿数据），然后前端js处理数据展示结果。整个项目测试范围包括前台问答页面，管理后台页面以及AI Engine。
项目职责：1.对智能客服的企业中/英文，运营商中/英文前台页面、后台管理页面功能进行测试
2.在AI Engine更新之后，对企业中/英文前后台页面功能进行测试
3.使用jmeter工具对ask.action,smartApi,AILA等接口进行压力测试
4.使用jmeter工具进行接口自动化测试
5.使用python搭建UI自动化测试框架，并编写测试用例，维护更新自动化脚本
6.编写管理后台使用说明，给客户提供答疑
7.定期更新并维护各环境管理后台的问答语料数据


----------------------1.1---log/basepage------------------------
from common.driver import Driver


class BasePage:

    def __init__(self, web=1):
        self.current_page = None
        self.driver = Driver(web)

    def link_page(self,url):
        self.driver.current_driver.get(url)
        self.driver.current_driver.maximize_window()

    # 页面前进
    def forward_page(self):
        self.driver.forward()

    # 页面回退
    def back_page(self):
        self.driver.back()

    # 返回当前页面的url
    def get_current_url(self):
        return self.driver.current_driver.current_url

    # 返回当前页面的title
    def get_current_title(self):
        return self.driver.current_driver.title

    # 获取当前窗口的handle
    def get_current_window_handle(self):
        return self.driver.current_driver.current_window_handles

    # 获取所有窗口的handle
    def get_windows_handles(self):
        return self.driver.current_driver.window_handles

    # 跳转到iframe页面， 可传参数name，id，如果iframe没有这个属性的话，可以用index或者element来定位
    def switch_to_iframe(self,index=0):
        self.driver.current_driver.switch_to.frame(index)

    # 回到原来的iframe页面
    def switch_to_back_default_iframe(self):
        self.driver.current_driver.switch_to.default_content()

    # 首页出现18岁年龄确认弹窗，关闭弹窗
    """
    def close_age_alert(self):
        self.driver.find_element("首页年龄弹窗确认").click()
    """
    #关闭浏览器
    def close_current_page(self):
        self.driver.close_browser()

if __name__ == '__main__':
    enrobotpage = BasePage()
    enrobotpage.driver.open_browser("http://www.multilotto.com/en")
    enrobotpage.driver.find_element("首页弹窗确认").click()
    enrobotpage.link_page()


----------------------1.2---log/driver------------------------

from selenium import webdriver
from common.elementRead import ElementsRead
from selenium.webdriver.common.action_chains import ActionChains

import time


class Driver:
    def __init__(self, web=1):
        self.elementRead = ElementsRead()
        if web == 1:
            self.current_driver = webdriver.Chrome()
        elif web == 2:
            self.current_driver = webdriver.Ie()
        elif web == 3:
            self.current_driver = webdriver.Firefox()
        self.action = ActionChains(self.current_driver)

    #打开浏览器，输入url，然后最大化
    def open_browser(self, url):
        self.current_driver.maximize_window()
        self.current_driver.get(url)
        return self.current_driver

    def getwindow_size(self):
        self.current_driver.get_window_size()

    def setwindow_size(self, width, height, windowHandle='current'):
        self.current_driver.set_window_size(width, height, windowHandle)

    def close_browser(self):
        self.current_driver.quit()

    def find_element(self, name=None):
        pathType = self.elementRead.getPathType(name)
        pathValue = self.elementRead.getPathValue(name)
        if pathType.lower() == 'id':
            return self.current_driver.find_element_by_id(pathValue)
        elif pathType.lower() == 'class_name':
            return self.current_driver.find_element_by_class_name(pathValue)
        elif pathType.lower() == 'name':
            return self.current_driver.find_element_by_name(pathValue)
        elif pathType.lower() == 'css_selector':
            return self.current_driver.find_element_by_css_selector(pathValue)
        elif pathType.lower() == 'xpath':
            return self.current_driver.find_element_by_xpath(pathValue)
        elif pathType.lower() == 'link_text':
            return self.current_driver.find_element_by_link_text(pathValue)
        elif pathType.lower() == 'tag_name':
            return self.current_driver.find_element_by_tag_name(pathValue)
        elif pathType.lower() == 'partial_link_text':
            return self.current_driver.find_element_by_partial_link_text(pathValue)

    def find_elements(self, name=None):
        pathType = self.elementRead.getPathType(name)
        pathValue = self.elementRead.getPathValue(name)
        if pathType == 'id':
            return self.current_driver.find_elements_by_id(pathValue)
        elif pathType == 'class_name':
            return self.current_driver.find_elements_by_class_name(pathValue)
        elif pathType == 'name':
            return self.current_driver.find_elements_by_name(pathValue)
        elif pathType == 'css_selector':
            return self.current_driver.find_elements_by_css_selector(pathValue)
        elif pathType == 'xpath':
            return self.current_driver.find_elements_by_xpath(pathValue)
        elif pathType == 'link_text':
            return self.current_driver.find_elements_by_link_text(pathValue)
        elif pathType == 'tag_name':
            return self.current_driver.find_elements_by_tag_name(pathValue)
        elif pathType == 'partial_link_text':
            return self.current_driver.find_elements_by_partial_link_text(pathValue)

    def element_is_exist(self, name):
        if len(self.find_elements(name)) == 0:
            return False
        return True

    def alter(self):
        return self.current_driver.switch_to.alert()

    def is_alter_present(self):
        try:
            self.current_driver.switch_to.alert()
            return True
        except Exception as e:
            print(e)
            return False


    # 鼠标右键
    def right_click(self, element_name=None):
        ac = ActionChains(self.current_driver)
        return ac.context_click(self.find_element(element_name)).perform()

    def forward(self):
        self.current_driver.forward()

    def back(self):
        self.current_driver.back()
if __name__ == '__main__':
    dr = Driver(1)
    dr.open_browser('http://www.multilotto.com/en')
    time.sleep(2)
    #dr.find_element("百度搜索输入框").send_keys("haha")
    print(dr.is_alter_present())
    dr.find_element("首页弹窗确认").click()
    time.sleep(10)
    print(dr.is_alter_present())
    dr.find_element("首页图标").click()
    #dr.close_brwser()
    
   ----------------------1.3---log/elementRead------------------------
   
   import xml.etree.cElementTree as MyElementTree


class ElementsRead:

    def __init__(self):
        xml_file_path = 'D:\\MLUIproject-master\\testFile\\config.xml'  # 文件路径
        self.tree = MyElementTree.parse(xml_file_path)
        self.root = self.tree.getroot()

    # 获取所有元素name，type，value，返回一个二维列表
    def get_all_elements(self):
        elements = []
        for children in self.root.findall('element'):
            name = children.find('name').text
            path_type = children.find('pathType').text
            path_value = children.find('pathValue').text
            t = [name, path_type, path_value]
            elements.append(t)
        return elements

        # 获取所有元素的name， 返回一个list
    def get_all_elements_name(self):
        temp_list = ElementsRead().get_all_elements()
        name_list = []
        for i in temp_list:
            name = i[0]
            name_list.append(name)
        return name_list

        # 根据元素的name，返回元素的定位方式path，如果元素不存在则返回none
    def getPathType(self, name):
        path_type_list = ElementsRead().get_all_elements()
        for i in path_type_list:
            if i[0] == name:
                return i[1]

        # 根据xml文件的name， 返回元素定位的value，如果元素不存在则返回none
    def getPathValue(self, name):
        path_value_list = ElementsRead().get_all_elements()
        for i in path_value_list:
            if i[0] == name:
                return i[2]


if __name__ == '__main__':
    r1 = ElementsRead()
    print(r1.get_all_elements())
    print(r1.get_all_elements_name())


----------------------1.4---log/log------------------------

import logging
import os
import time

get_path = os.path.dirname(os.path.abspath(__file__))
log_path = os.path.join(get_path, 'log')
if not os.path.exists(log_path):
    os.mkdir(log_path)


class Log:
    def __init__(self):
        self.logname = os.path.join(log_path, time.strftime('%Y.%m.%d.%H.%M.%S', time.localtime(time.time())) + '.log')
        self.logger = logging.getLogger()
        self.logger.setLevel(logging.DEBUG)
        self.formatter = logging.Formatter('[%(asctime)s] - %(filename)s] - %(levelname)s: %(message)s')

    def __console(self, level, message):
        # 创建一个fileHandler，写到本地
        fh = logging.FileHandler(self.logname, 'a', encoding='utf-8')
        fh.setLevel(logging.DEBUG)
        fh.setFormatter(self.formatter)
        self.logger.addHandler(fh)

        # 创建一个streamHandler，输出到控制台
        ch = logging.StreamHandler()
        ch.setLevel(logging.DEBUG)
        ch.setFormatter(self.formatter)
        self.logger.addHandler(ch)

        if level == 'info':
            self.logger.info(message)
        elif level == 'debug':
            self.logger.debug(message)
        elif level == 'warining':
            self.logger.warning(message)
        elif level == 'error':
            self.logger.error(message)

        self.logger.removeHandler(ch)
        self.logger.removeHandler(fh)

        fh.close()

    def debug(self, message):
        self.__console('debug', message)

    def info(self, message):
        self.__console('info', message)

    def warning(self, message):
        self.__console('warning', message)

    def error(self, message):
        self.__console('error', message)


if __name__ == '__main__':
    log = Log()
    log.info('--测试开始')
    log.info('操作步骤1，2，3')
    log.warning('测试结束')
    print(log.logname)
    
    ----------------------1.5---log/readconfig------------------------
    
    import xml.etree.cElementTree as ET


class ReadConfig:

    def __init__(self):
        xml_file_path = 'C:\\Users\\monitor\\PycharmProjects\\UIAuto\\testFile\\config.xml'
        self.tree = ET.parse(xml_file_path)
        self.root = self.tree.getroot()

    # def xml_pathType(self):
    #     for path_type in self.root.iter('name'):
    #         return (path_type.text)
    def get_element_method(self):
        list = []
        for children in self.root.findall('element'):
            name = children.find('name').text
            path_type = children.find('pathType').text
            path_value = children.find('pathValue').text
            t = [name, path_type, path_value]
            list.append(t)
        return list

    def getPathType(self, name):
        list = ReadConfig().get_element_method()
        for i in list:
            if i[0] == name:
                return i[1]

    def getPathValue(self, name):
        list = ReadConfig().get_element_method()
        for i in list:
            if i[0] == name:
                return i[2]


if __name__ == '__main__':
    r1 = ReadConfig()
    print(r1.get_element_method())
    print(r1.getPathType('email'))
    print(r1.getPathValue('email'))

----------------------1.6---log/screen------------------------

from selenium import webdriver


class Screen(object):
    u'''返个应该截图功能的装饰器'''

    def __init__(self, driver):
        self.driver = driver

    def __call__(self, f):
        def inner(*args):
            try:
                return f(*args)
            except:
                import time
                nowTime = time.strftime("%Y_%m_%d_%H_%M_%S")
                self.driver.get_screenshot_as_file('%s.jpg' % nowTime)
                raise
        return inner
        
      ----------------------2.1---page/homepage------------------------
      
      
from common.basepage import BasePage
from common.driver import Driver
from time import sleep

class HomePage(BasePage):
    # 进入网站首页，传入站点名称即可
    def link_home_page(self, website=1):
        if website ==1:
            self.link_page("http://rnd-suptest.huawei.com/enrobot")  # 企业英文测试前台
        elif website == 2:
            self.link_page("http://support-trial.huawei.com/enrobot")  # 企业英文蓝环境前台
        elif website == 3:
            self.link_page("http://support.huawei.com/enrobot")  # 企业英文生产前台
        elif website == 4:
            self.link_page("http://support.huawei.com/iknow")  # 企业英文生产前台（对外）

    # 点击首页右下角的all，刷新为全部分类
    def refresh_category_all(self):
        self.driver.current_driver.switch_to.frame(0)
        self.driver.find_element("all").click()

    def click_category(self,categoryName):
        # 打开企业英文生产对外前台页面，并且最大化，website = 4时为打开生产对外前台
        self.link_home_page(4)
        sleep(3)
        # 点击右侧的Enterprise Access
        self.switch_to_iframe(0)
        self.switch_to_iframe("hwIframe2")
        self.switch_to_iframe(0)
        self.driver.find_element(categoryName).click()

        # 跳出iframe
        self.switch_to_back_default_iframe()

    def left_part_content(self):
        # 获取左侧iframe内容
        self.switch_to_iframe(0)
        self.switch_to_iframe("hwIframe2")
        left_content = self.driver.find_element("left iframe content").text
        return left_content

        # 跳出iframe
        self.switch_to_back_default_iframe()

    def below__category_content(self):
        # 获取下方产品线内容
        self.switch_to_iframe(0)
        self.switch_to_iframe("hwIframe2")
        below_content = self.driver.find_element("below_content").text
        return below_content

        # 跳出iframe
        self.switch_to_back_default_iframe()

    def ask_question(self,question):
        # 定位下方的输入框，并输入标准问题
        self.switch_to_iframe(0)
        self.switch_to_iframe("hwIframe2")
        self.driver.find_element("Input box").send_keys(question)
        self.driver.find_element("send").click()

        # 跳出iframe
        self.switch_to_back_default_iframe()


if __name__ == '__main__':
    homePage = HomePage()
    homePage.link_home_page(1)
    print("a")
    homePage.refresh_category_all()
    sleep(2)
    print("b")
    homePage.close_current_page()
    print("c")

----------------------3---result无变化------------------------

----------------------4.1---testCaseFront/test001------------------------

from selenium import webdriver
from common.basepage import BasePage
from common.driver import Driver
from common.elementRead import ElementsRead
from page.homepage import HomePage
from common.log import Log
import unittest
from time import sleep

# test001:欢迎语是否推送,以及内容的正确性
class FrontTest(unittest.TestCase):
    front_page = HomePage()

    def setUp(self):
        # 实例化一个HomePage对象,定义为Test001的属性
        self.log = Log()
        self.log.info("测试开始：front test")

    def test_001(self):
        # 打开企业英文生产对外前台页面，并且最大化，website = 4时为打开生产对外前台
        self.front_page.link_home_page(4)

        # 获取登录状态（text = login为未登录，text = logout 为已登录）
        self.front_page.driver.current_driver.switch_to.frame(0)
        self.front_page.driver.current_driver.switch_to.frame("hwIframe1")
        status_login = self.front_page.driver.element_is_exist("login")

        # 跳出iframe
        self.front_page.switch_to_back_default_iframe()

        # 获取欢迎语内容
        sleep(3)
        welcome_content = self.front_page.left_part_content()

        # 断言
        if status_login == True:
            self.assertIn("Log in", welcome_content)
            print("未登录，欢迎语内容正确")
        elif status_login == False:
            self.assertNotIn("Log in", welcome_content)
            print("登录，欢迎语内容正确")

    def test_004(self):
        # 打开企业英文生产对外前台页面，并且最大化，website = 4时为打开生产对外前台
        self.front_page.link_home_page(4)

        sleep(1)
        # 点击右侧的Enterprise Access
        self.front_page.click_category("enterprise Access")

        # 获取下方产品线内容
        sleep(2)
        below_category_content = self.front_page.below__category_content()

        # 断言
        self.assertIn("Enterprise Access", below_category_content)
        print("自动识别产品线成功")


    def tearDown(self):
        self.log.info('结束测试：test')
        sleep(2)
        self.front_page.close_current_page()

if __name__ == '__main__':
    unittest.main()

----------------------4.2---testCaseFront/test004------------------------


from selenium import webdriver
from common.basepage import BasePage
from common.driver import Driver
from common.elementRead import ElementsRead
from page.homepage import HomePage
from common.log import Log
import unittest
from time import sleep

# test004:点击分类到Enterprise Access，下方识别产品线
class Test004(unittest.TestCase):
    test004 = HomePage()

    def setUp(self):
        # 实例化一个HomePage对象,定义为Test004的属性
        self.log = Log()
        self.log.info("测试开始：test004")

    def test_004(self):
        # 打开企业英文生产对外前台页面，并且最大化，website = 4时为打开生产对外前台
        self.test004.link_home_page(4)

        sleep(1)
        # 点击右侧的Enterprise Access
        self.test004.click_category("enterprise Access")

        # 获取下方产品线内容
        sleep(2)
        below_category_content = self.test004.below__category_content()

        # 断言
        self.assertIn("Enterprise Access", below_category_content)
        print("自动识别产品线成功")

    def tearDown(self):
        self.log.info('结束测试：test004')
        sleep(2)
        self.test004.close_current_page()

if __name__ == '__main__':
    unittest.main()

----------------------5.1---testFile/config.xml------------------------

<?xml version="1.0" encoding="UTF-8"?>
<page>
    <element>
        <name>百度搜索输入框</name>
        <pathType>id</pathType>
        <pathValue>kw</pathValue>
    </element>
    <element page = "首页">
        <name>首页图标</name>
        <pathType>class_name</pathType>
        <pathValue>logo-cont</pathValue>
    </element>
    <element page = "首页">
        <name>首页弹窗</name>
        <pathType>xpath</pathType>
        <pathValue>.//*[@id='modal']</pathValue>
    </element>
    <element page = "首页">
        <name>首页年龄弹窗确认</name>
        <pathType>xpath</pathType>
        <pathValue>.//*[@id='modal']/div[2]/a</pathValue>
    </element>
    <element page ="首页">
        <name>首页signin按钮</name>
        <pathType>class_name</pathType>
        <pathValue>go-login</pathValue>
    </element>
    <element page ="首页">
        <name>首页signup按钮</name>
        <pathType>class_name</pathType>
        <pathValue>go-sign</pathValue>
    </element>
    <element page ="登录页">
        <name>用户名输入框</name>
        <pathType>name</pathType>
        <pathValue>email</pathValue>
    </element>
    <element page = "登录页">
        <name>密码输入框</name>
        <pathType>name</pathType>
        <pathValue>password</pathValue>
    </element>
     <element page = "登录页">
        <name>登录提交按钮</name>
        <pathType>xpath</pathType>
        <pathValue>.//*[@id='wrapper']/div[2]/div[2]/div[2]/div[7]</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>enterprise Access</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="datacom"]/a[1]</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>all</name>
        <pathType>xpath</pathType>
        <pathValue>/html/body/div/dl[8]/dt/a</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>login</name>
        <pathType>id</pathType>
        <pathValue>loginBtn</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>logout</name>
        <pathType>id</pathType>
        <pathValue>logoutBtn</pathValue>
    </element>
     <element page = "enterprise 生产前台">
        <name>loginWelcome</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="outputArea"]/dl[1]/dd/div/p</pathValue>
    </element>
     <element page = "enterprise 生产前台">
        <name>logoutWelcome</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="outputArea"]/dl[1]/dd/div/p</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>below_content</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="locId"]</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>left iframe content</name>
        <pathType>id</pathType>
        <pathValue>outputArea</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>common question</name>
        <pathType>id</pathType>
        <pathValue>submitLink</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>Input box</name>
        <pathType>id</pathType>
        <pathValue>inputArea</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>send</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="inputButtonDiv"]/img</pathValue>
    </element>
    <element page = "enterprise 生产前台">
        <name>solved</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="submitLink"]/span</pathValue>
    </element>
     <element page = "enterprise 生产前台">
        <name>unsolved</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="submitLink"]/span</pathValue>
    </element>
     <element page = "enterprise 生产前台">
        <name>guzhangshu</name>
        <pathType>xpath</pathType>
        <pathValue>//*[@id="abgp_peer_setup_failure_desk000__fig01"]/div/div/img</pathValue>
    </element>
</page>
----------------------6---runAllTestCase------------------------

from testCaseFront.test001 import FrontTest
from testCaseFront.test004 import Test004
from testCaseFront.test005 import Test005
from testCaseFront.test007 import Test007
from testCaseFront.test008 import Test008
from testCaseFront.test009 import Test009
from testCaseFront.test010 import Test010
from testCaseFront.test011 import Test011
from testCaseFront.test012 import Test012
from testCaseFront.test014 import Test014
import unittest
from result.testResult import TestResult


def run():

    all_test_cases = [FrontTest('test_001'),Test004('test_004'),Test005('test_005'),Test007('test_007'),Test008('test_008'),
                      Test009('test_009'),Test010('test_010'),Test011('test_011'),Test012('test_012'),Test014('test_014')]
    test_result = TestResult()
    test_result.suite.addTests(all_test_cases)
    test_result.get_html_report()
    test_result.get_text_result()


run()


